<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Unit Price & Quantity Calculator</title>

  <!-- PWA -->
  <link rel="manifest" href="./manifest.webmanifest" />
  <meta name="theme-color" content="#111111" />

  <!-- UI (external; gets cached at runtime) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet" />

  <style>
    :root {
      --color-primary-light: 56 189 248;
      --color-primary-dark: 14 165 233;
      --color-bg-light: 255 255 255;
      --color-bg-dark: 0 0 0;
    }
    body {
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      transition: background-color .5s, color .5s;
      background: rgb(var(--color-bg-light));
    }
    body.dark { background: rgb(var(--color-bg-dark)); color: #f3f4f6; }
    .card { background: #fff; transition: background-color .4s, color .4s; }
    body.dark .card { background: #111; color: #f3f4f6; }
    input,select { transition: background-color .4s, color .4s, border-color .4s; }
    body.dark input, body.dark select { background: #000; color: #f3f4f6; border-color: #333; }
    .toggle-wrapper { position:relative; width:50px; height:26px; background:#ddd; border-radius:9999px; transition:background-color .4s; cursor:pointer; }
    .toggle-wrapper.dark { background: rgb(var(--color-primary-dark)); }
    .toggle-circle { position:absolute; top:2px; left:2px; width:22px; height:22px; background:#fff; border-radius:50%; transition: transform .4s cubic-bezier(.45,0,.55,1); }
    .toggle-wrapper.dark .toggle-circle { transform: translateX(24px); }
    .mode-toggle-button { transition: all .3s ease-in-out; }
    .mode-toggle-active { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,.15); }
    .install-hint { display:none; }

    /* ===== Dynamic colors per mode (super simple) ===== */
    body[data-mode="quantity"] { --main-color: #0ea5e9; }  /* sky-500 */
    body[data-mode="amount"]   { --main-color: #f59e0b; }  /* amber-500 */

    .colored-text   { color: var(--main-color) !important; transition: color .3s ease; }
    .colored-bg     { background-color: var(--main-color) !important; color: #fff !important; transition: background-color .3s ease; }
    .colored-border { border: 2px solid var(--main-color) !important; transition: border-color .3s ease; }
  </style>
</head>

<!-- Start in quantity mode; data-mode drives all colors -->
<body data-mode="quantity" class="light">
  <div class="min-h-screen flex items-center justify-center p-4">
    <div class="card w-full max-w-lg p-6 md:p-8 rounded-xl shadow-2xl relative colored-border">

      <!-- Dark Mode Toggle -->
      <div class="absolute top-4 right-4 flex items-center space-x-2">
        <div id="themeToggle" class="toggle-wrapper" onclick="toggleTheme()">
          <div class="toggle-circle"></div>
        </div>
      </div>

      <!-- Title uses dynamic color -->
      <h1 class="text-3xl font-extrabold mb-6 mt-8 text-center colored-text">Unit Converter</h1>

      <!-- Mode Toggle (border also uses dynamic color) -->
      <div class="flex rounded-lg p-1 mb-8 shadow-md colored-border">
        <button id="mode-quantity"
                onclick="setMode('quantity')"
                class="mode-toggle-button flex-1 py-2 text-sm font-semibold rounded-md mode-toggle-active bg-sky-500 text-white">
          Calculate Quantity
        </button>
        <button id="mode-amount"
                onclick="setMode('amount')"
                class="mode-toggle-button flex-1 py-2 text-sm font-semibold rounded-md text-gray-600 dark:text-gray-300">
          Calculate Amount
        </button>
      </div>

      <!-- Inputs -->
      <div id="quantity-inputs" class="space-y-6">
        <div class="budget-field">
          <label for="budget" class="block text-sm font-medium mb-1">Your Budget (â‚¹)</label>
          <input type="number" id="budget" placeholder="e.g., 500" class="w-full p-3 border rounded-lg text-gray-900" oninput="calculate()">
        </div>

        <div class="flex space-x-4">
          <div class="flex-grow">
            <label for="price-value" class="block text-sm font-medium mb-1">Price Per Unit (â‚¹)</label>
            <input type="number" id="price-value" placeholder="e.g., 100" class="w-full p-3 border rounded-lg text-gray-900" oninput="calculate()">
          </div>
          <div class="w-32">
            <label for="price-unit" class="block text-sm font-medium mb-1">Unit</label>
            <select id="price-unit" class="w-full p-3 border rounded-lg" onchange="calculate()">
              <option value="kg">â‚¹/kg</option>
              <option value="gram">â‚¹/gram</option>
              <option value="100g">â‚¹/100 Gram</option>
            </select>
          </div>
        </div>

        <div class="purchase-field">
          <label for="quantity-value" class="block text-sm font-medium mb-1">Quantity You Wish To Purchase</label>
          <div class="flex space-x-4">
            <div class="flex-grow">
              <input type="number" id="quantity-value" placeholder="e.g., 500" class="w-full p-3 border rounded-lg text-gray-900" oninput="calculate()">
            </div>
            <div class="w-32">
              <select id="quantity-unit" class="w-full p-3 border rounded-lg" onchange="calculate()">
                <option value="gram">Gram</option>
                <option value="kg">Kg</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <!-- Result uses dynamic background color -->
      <div id="resultBox" class="mt-8 p-4 rounded-xl text-center colored-bg shadow-lg transition-all duration-300">
        <p id="result-label" class="text-sm font-light uppercase tracking-wider mb-1">Max Quantity You Can Buy:</p>
        <p id="result-value" class="text-4xl font-bold">0.00</p>
        <p id="result-unit" class="text-lg font-semibold">grams</p>
      </div>

      <p class="text-xs text-center mt-6 text-gray-500 dark:text-gray-400">1 kg = 1000 grams</p>

      <!-- Install hint (optional) -->
      <button id="installBtn" class="install-hint mt-6 mx-auto block px-4 py-2 rounded bg-sky-500 text-white">Install App</button>
    </div>
  </div>

  <script>
    const $ = id => document.getElementById(id);
    let currentMode='quantity', currentTheme='light';

    function getPricePerGram(price,u){return u==='kg'?price/1000:u==='100g'?price/100:price;}
    function getTotalGrams(q,u){return u==='kg'?q*1000:q;}

    function calculate(){
      const price=parseFloat($('price-value').value)||0,
            unit=$('price-unit').value,
            perGram=getPricePerGram(price,unit),
            resV=$('result-value'),resU=$('result-unit'),resL=$('result-label');
      if(perGram<=0){resV.textContent='0.00';return;}
      if(currentMode==='quantity'){
        const budget=parseFloat($('budget').value)||0,grams=budget/perGram;
        if(grams>=1000){resV.textContent=(grams/1000).toFixed(3);resU.textContent='kg';}
        else{resV.textContent=grams.toFixed(2);resU.textContent='grams';}
        resL.textContent='Max Quantity You Can Buy:';
      }else{
        const q=parseFloat($('quantity-value').value)||0,qu=$('quantity-unit').value,
              g=getTotalGrams(q,qu),cost=g*perGram;
        resV.textContent=cost.toFixed(2);resU.textContent='â‚¹';resL.textContent='Estimated Total Cost:';
      }
    }

    /* SWITCH MODES + COLORS (only place you need to touch for behavior) */
    function setMode(m){
      currentMode = m;
      const qBtn=$('mode-quantity'), aBtn=$('mode-amount'),
            b=document.querySelector('.budget-field'),
            p=document.querySelector('.purchase-field');

      // ðŸŒˆ Single line: change all colors via CSS variable
      document.body.setAttribute('data-mode', m);

      if(m==='quantity'){
        // Buttons colors (tailwind classes for the buttons themselves)
        qBtn.classList.add('mode-toggle-active','bg-sky-500','text-white');
        qBtn.classList.remove('text-gray-600','dark:text-gray-300');
        aBtn.classList.remove('mode-toggle-active','bg-amber-500','text-white');
        aBtn.classList.add('text-gray-600','dark:text-gray-300');

        b.style.display='block'; p.style.display='none';
      }else{
        aBtn.classList.add('mode-toggle-active','bg-amber-500','text-white');
        aBtn.classList.remove('text-gray-600','dark:text-gray-300');
        qBtn.classList.remove('mode-toggle-active','bg-sky-500','text-white');
        qBtn.classList.add('text-gray-600','dark:text-gray-300');

        b.style.display='none'; p.style.display='block';
      }
      calculate();
    }

    function toggleTheme(){
      const body=document.body,toggle=$('themeToggle');
      if(currentTheme==='light'){body.classList.add('dark');toggle.classList.add('dark');currentTheme='dark';}
      else{body.classList.remove('dark');toggle.classList.remove('dark');currentTheme='light';}
    }

    // PWA registration + install prompt
    let deferredPrompt=null;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      const btn = $('installBtn');
      btn.style.display = 'block';
      btn.onclick = async () => {
        btn.style.display = 'none';
        await deferredPrompt.prompt();
        deferredPrompt = null;
      };
    });

    window.onload=()=>{
      if(window.matchMedia('(prefers-color-scheme: dark)').matches) toggleTheme();
      setMode('quantity');

      if('serviceWorker' in navigator){
        navigator.serviceWorker.register('./sw.js', { scope: './' })
          .catch(err => console.log('SW reg failed:', err));
      }
    };
  </script>
</body>
</html>
